# 02.Hadoop Distributed File Systemï¼ˆHDFSï¼‰

## 1.ç®€ä»‹

HDFSæ˜¯Hadoopçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†å¤§è§„æ¨¡æ•°æ®é›†ã€‚ä¸‹é¢æ˜¯å…³äºHDFSçš„åŸºæœ¬æ¦‚å¿µçš„æ¦‚è¿°ï¼š

### å—å­˜å‚¨

HDFSå°†å¤§æ–‡ä»¶åˆ‡åˆ†ä¸ºå›ºå®šå¤§å°çš„æ•°æ®åº“ï¼ˆé€šå¸¸ä¸º64MBæˆ–128MBï¼‰ï¼Œå¹¶å°†è¿™äº›å—åˆ†æ•£å­˜å‚¨åœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªæ•°æ®å—éƒ½æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œé»˜è®¤æƒ…å†µä¸‹é€šå¸¸æœ‰3ä¸ªå‰¯æœ¬ã€‚è¿™æ•°æ®å—çš„åˆ†å¸ƒå¼æ–¹å¼æœ‰åŠ©äºæé«˜æ•°æ®çš„å¯é æ€§å’Œå®¹é”™æ€§ã€‚

### NameNodeå’ŒDataNode

#### NameNode

NameNodeæ˜¯HDFSçš„ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†æ–‡ä»¶ç³»ç»Ÿçš„å‘½åç©ºé—´å’Œå…ƒæ•°æ®ã€‚å®ƒç»´æŠ¤äº†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ã€æ–‡ä»¶å’Œå—çš„æ˜ å°„å…³ç³»ç­‰å…ƒæ•°æ®ä¿¡æ¯ã€‚

NameNodeä¹Ÿè´Ÿè´£åè°ƒå®¢æˆ·ç«¯çš„æ–‡ä»¶è®¿é—®è¯·æ±‚ï¼Œå¹¶å°†æ•°æ®å—çš„ä½ç½®ä¿¡æ¯æä¾›ç»™å®¢æˆ·ç«¯ã€‚

#### DataNode

DataNodeæ˜¯HDFSçš„æ•°æ®èŠ‚ç‚¹ï¼Œè´Ÿè´£å­˜å‚¨å®é™…çš„æ•°æ®å—ã€‚æ•°æ®èŠ‚ç‚¹æ ¹æ®NameNodeçš„æŒ‡ç¤ºå­˜å‚¨æ•°æ®å—ï¼Œå¹¶åœ¨éœ€è¦æ—¶æä¾›æ•°æ®å—çš„è¯»å–å’Œå†™å…¥æœåŠ¡ã€‚

DataNodeè¿˜ä¼šå‘NameNodeæŠ¥å‘Šè‡ªèº«çš„å¥åº·çŠ¶æ€å’Œå­˜å‚¨å®¹é‡ä¿¡æ¯ã€‚

```mermaid
%%{init: {"flowchart": {"htmlLabels": false}} }%%
%%{init: {'theme':'neutral'}}%%
flowchart
A("åç§°èŠ‚ç‚¹ï¼ˆNamenodeï¼‰")
B(("å®¢æˆ·ç«¯ï¼ˆClientï¼‰"))
subgraph C["æ•°æ®èŠ‚ç‚¹ï¼ˆDatanodesï¼‰"]
    C1["ğŸŸ©ğŸŸ©ğŸŸ©"]
    C2["ğŸŸ©ğŸŸ©ğŸŸ©"]
    subgraph C3[" "]
        C3-1["ğŸŸ©"]
        C3-2["ğŸŸ©"]
    end
    C1 & C2 & C3 --> C4["æœºæ¶ï¼ˆRackï¼‰ 1"]
end
D(("å®¢æˆ·ç«¯ï¼ˆClientï¼‰"))
subgraph E["æ•°æ®èŠ‚ç‚¹ï¼ˆDatanodesï¼‰"]
    subgraph E1[" "]
        E1-1["ğŸŸ©"]
        E1-2["ğŸŸ©"]
	end
    E2["ğŸŸ©ğŸŸ©ğŸŸ©Blocks"]
    E1 & E2 --> E3["æœºæ¶ï¼ˆRackï¼‰2"]
end

A --> O["Metadata(Name,replicas),...":/home/foo/data,3,...]
C1 --"è¯»ï¼ˆReadï¼‰"-->B -."å…ƒæ•°æ®æ“ä½œï¼ˆMetadata opsï¼‰".-> A
D --"å†™ï¼ˆWriteï¼‰"--> C3-2 & E1-1
E1-2 =="å¤åˆ¶ï¼ˆReplicationï¼‰"==> C3-1
%% style B fill:#4
```



### æ•°æ®å¤åˆ¶ï¼ˆBlock Replicationï¼‰

HDFSé€šè¿‡åœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªæ•°æ®èŠ‚ç‚¹ä¸Šå­˜å‚¨æ•°æ®å—çš„å¤šä¸ªå‰¯æœ¬æ¥æä¾›æ•°æ®å†—ä½™å’Œå®¹é”™æ€§ã€‚è¿™äº›å‰¯æœ¬é€šå¸¸åˆ†å¸ƒåœ¨ä¸åŒæœºæ¶ä¸Šï¼Œä»¥é˜²æ­¢æœºå™¨çº§åˆ«çš„æ•…éšœå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ•°æ®èŠ‚ç‚¹ä¹‹é—´é€šè¿‡å¿ƒè·³æœºåˆ¶å’Œå—æŠ¥å‘Šæ¥è¿›è¡Œé€šä¿¡å’Œæ•°æ®åŒæ­¥ã€‚

```mermaid
flowchart LR
subgraph B[Datanodes]
	subgraph B1[" "]
        B1-1[1]
        B1-2[2]
	end
	subgraph B2[" "]
		B2-2[2]
	end
	subgraph B3[" "]
		B3-1[1]
		B3-2[4]
	end
	subgraph B4[" "]
		B4-1[2]
		B4-2[5]
	end
	subgraph B5[" "]
		B5-1[5]
		B5-2[3]
	end
	subgraph B6[" "]
		B6-1[4]
	end
	subgraph B7[" "]
		B7-1[3]
		B7-2[5]
	end
	subgraph B8[" "]
		B8-1[4]
	end
end
subgraph A["Block Replication"]
    A1["Namenodeï¼ˆFilenameï¼ŒnumReplicasï¼Œblock-idsï¼Œ...ï¼‰\n/users/sameerp/data/part-0,r:2,{1,3},...\n/users/sameerp/data/part-1,r:3,{2,4,5},..."]
end
```



### å®¹é”™æ€§å’Œè‡ªåŠ¨æ¢å¤

HDFSå…·æœ‰é«˜åº¦çš„å®¹é”™æ€§ã€‚å½“æŸä¸ªæ•°æ®èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæˆ–æ•°æ®å—æŸåæ—¶ï¼ŒHDFSä¼šè‡ªåŠ¨å¤åˆ¶ä¸¢å¤±çš„æ•°æ®å—æˆ–æŸåçš„å‰¯æœ¬ã€‚æ­¤å¤–ï¼Œå½“NameNodeå‘ç”Ÿæ•…éšœæ—¶ï¼ŒHDFSæ”¯æŒä½¿ç”¨Secondary NameNodeæ¥è¿›è¡Œå…ƒæ•°æ®å¤‡ä»½å’Œæ¢å¤ã€‚

### é€šä¿¡åè®®

æ‰€æœ‰ HDFS é€šä¿¡åè®®éƒ½ä½äº TCP/IP åè®®ä¹‹ä¸Šã€‚å®¢æˆ·ç«¯ä¸ NameNode è®¡ç®—æœºä¸Šçš„å¯é…ç½®TCPç«¯å£å»ºç«‹è¿æ¥ã€‚å®ƒä¸ NameNode å¯¹è¯ ClientProtocolã€‚DataNode ä½¿ç”¨ DataNode åè®®ä¸ NameNode é€šä¿¡ã€‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ ( RPC ) æŠ½è±¡åŒ…è£…äº†å®¢æˆ·ç«¯åè®®å’Œæ•°æ®èŠ‚ç‚¹åè®®ã€‚æ ¹æ®è®¾è®¡ï¼ŒNameNode ä»ä¸å‘èµ·ä»»ä½• RPCã€‚ç›¸åï¼Œå®ƒåªå“åº” DataNode æˆ–å®¢æˆ·ç«¯å‘å‡ºçš„ RPC è¯·æ±‚ã€‚

## 2.å®‰è£…
